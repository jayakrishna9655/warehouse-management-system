<div class="container mt-4">
    <h2>Warehouse Inventory</h2>

    <div class="d-flex justify-content-between mb-3">
        <button class="btn btn-primary" (click)="openCreateModal()">+ Add New Product</button>
        <input type="text" class="form-control w-25" placeholder="Search SKU..." [(ngModel)]="searchTerm">
    </div>
    <table class="table table-bordered shadow-sm">
        <thead class="table-dark">
            <tr>
                <th>SKU</th>
                <th>Name</th>
                <th>Quantity</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let p of products">
                <td>{{p.sku}}</td>
                <td>{{p.name}}</td>
                <td>
                    <span [class]="p.quantity < 5 ? 'text-danger fw-bold' : ''">{{p.quantity}}</span>
                </td>
                <td>
                    <button class="btn btn-sm btn-info m-1" (click)="viewDetails(p)">View</button>
                    <button *ngIf="isAdmin" class="btn btn-danger m-1" (click)="deleteProduct(p.id)">Delete</button>
                    <button *ngIf="isAdmin" class="btn btn-primary m-1" (click)="printProduct(p.id)">Print</button>
                </td>
            </tr>
        </tbody>
    </table>
    <div class="row mt-4 mb-4">
        <div class="col-md-6">
            <div class="card p-3 shadow-sm h-100">
                <h5 class="text-center">Inventory by Category</h5>
                <div style="height: 250px; position: relative;">
                    <canvas #categoryChart></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="row h-100">
                <div class="col-12 mb-2">
                    <div class="card bg-primary text-white p-3 shadow-sm">
                        <h6>Total Inventory Value</h6>
                        <h3>{{ totalValue | currency:'INR' }}</h3>
                    </div>
                </div>
                <div class="col-12 mb-2">
                    <div class="card bg-warning text-dark p-3 shadow-sm">
                        <h6>Low Stock Items (< 5)</h6>
                                <h3>{{ lowStockCount }}</h3>
                    </div>
                </div>
                <div class="col-12">
                    <div class="card bg-danger text-white p-3 shadow-sm">
                        <h6>Out of Stock</h6>
                        <h3>{{ outOfStockCount }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" *ngIf="selectedProduct">
    <div class="custom-modal">
        <h3>Product Details</h3>
        <hr>
        <p><strong>SKU:</strong> {{selectedProduct.sku}}</p>
        <p><strong>Name:</strong> {{selectedProduct.name}}</p>
        <p><strong>Category:</strong> {{selectedProduct.category}}</p>
        <p><strong>Price:</strong> ${{selectedProduct.price}}</p>
        <button class="btn btn-secondary" (click)="selectedProduct = null">Close</button>
    </div>
</div>
<router-outlet></router-outlet>